# Use official Node 18 image
FROM node:18

# Install bash and MySQL client
RUN apt-get update && apt-get install -y bash default-mysql-client && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy package.json and install dependencies
COPY package*.json ./
RUN npm install

# Copy the rest of the app code
COPY . .

# Make wait.sh executable
RUN chmod +x wait.sh

# Expose backend port
EXPOSE 4000

# Default command: run wait.sh to wait for MySQL before starting backend
CMD ["bash", "./wait.sh"]



# For connection to set up database container in your instance

# cat > ~/three-tier-web-app/application-code/app-tier/Dockerfile << 'EOF'
# # Use official Node 18 image
# FROM node:18

# # Install bash and MySQL client
# RUN apt-get update && apt-get install -y bash default-mysql-client && rm -rf /var/lib/apt/lists/*

# # Create and use non-root user
# RUN useradd -m app_user

# # Set working directory
# WORKDIR /app

# # Copy package.json and install dependencies as root first
# COPY package*.json ./
# RUN npm install

# # Copy the rest of the app code
# COPY . .

# # Adjust permissions so app_user owns the files
# RUN chown -R app_user:app_user /app

# # Switch to non-root user
# USER app_user

# # Make wait.sh executable
# RUN chmod +x wait.sh

# # Expose backend port
# EXPOSE 4000

# # Start the app (waits for MySQL first)
# CMD ["bash", "./wait.sh"]
# EOF
